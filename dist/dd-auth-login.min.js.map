{"version":3,"sources":["webpack://ddAuthLogin/webpack/universalModuleDefinition","webpack://ddAuthLogin/webpack/bootstrap","webpack://ddAuthLogin/./src/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__webpack_exports__","login","_noop","myObj","libName","debug","signUrl","ssoUrl","success","fail","jsApiList","logger","console","log","error","warn","info","_ajax","options","type","toUpperCase","dataType","XMLHttpRequest","xhr","ActiveXObject","onreadystatechange","readyState","status","responseText","responseXML","open","url","send","setRequestHeader","data","_getSign","location","href","res","JSON","parse","str","_config","content","corpId","dd","config","agentId","timeStamp","nonceStr","signature","hasLogin","ready","runtime","permission","requestAuthCode","onSuccess","code","onFail","err","stringify","ndd","version"],"mappings":"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","file":"dd-auth-login.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ddAuthLogin\"] = factory();\n\telse\n\t\troot[\"ddAuthLogin\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","// A auth login js library from Dingtalk\n// Author: Leo\n// Last update: 2019.08.01\n\nvar __NAME__ = 'ddAuthLogin'\nvar _noop = function() {}\n\nvar myObj = {\n  libName: __NAME__,\n  debug: false,\n  // 请求签名地址\n  signUrl: '/data/labc-biz-dingding/dingTalk/getAuthInfo',\n  // 请求sso地址\n  ssoUrl: '/data/labc-biz-dingding/dingTalk/sso',\n  // 成功回调\n  success: _noop,\n  // 失败回调\n  fail: _noop,\n  // 要签名的功能列表\n  jsApiList: [\n    'runtime.permission.requestAuthCode',\n    'biz.util.datepicker',\n    'biz.util.timepicker',\n    'biz.util.datetimepicker',\n    'biz.ding.post',\n    'biz.telephone.call',\n    'biz.user.get',\n    'biz.contact.choose',\n    'biz.contact.createGroup',\n    'biz.contact.complexChoose',\n    'biz.util.chosen',\n    'biz.util.openLink',\n    'biz.util.uploadImage',\n    'biz.util.previewImage',\n    'biz.util.open',\n    'biz.util.share',\n    'biz.navigation.setTitle',\n    'biz.navigation.setLeft',\n    'biz.navigation.setRight',\n    'biz.navigation.close',\n    'biz.chat.pickConversation',\n    'biz.chat.chooseConversation',\n    'biz.chat.toConversation',\n    'biz.chat.chooseConversationByCorpId',\n    'biz.navigation.setIcon',\n    'ui.progressBar.setColors',\n    'ui.webViewBounce.disable',\n    'ui.input.plain',\n    'device.audio.startRecord',\n    'device.audio.stopRecord',\n    'device.audio.translateVoice',\n    'biz.telephone.showCallMenu',\n    'device.geolocation.get',\n    'biz.navigation.hideBar'\n  ]\n}\n\nvar logger =\n  typeof console === 'undefined'\n    ? {\n        log: _noop,\n        debug: _noop,\n        error: _noop,\n        warn: _noop,\n        info: _noop\n      }\n    : console\n\nif (!logger.debug) logger.debug = _noop\n\nfunction _ajax(options) {\n  options = options || {}\n  options.type = (options.type || 'GET').toUpperCase()\n  options.dataType = options.dataType || 'json'\n\n  if (window.XMLHttpRequest) {\n    var xhr = new XMLHttpRequest()\n  } else {\n    var xhr = new ActiveXObject('Microsoft.XMLHTTP')\n  }\n\n  xhr.onreadystatechange = function() {\n    if (xhr.readyState == 4) {\n      var status = xhr.status\n      if (status >= 200 && status < 300) {\n        options.success && options.success(xhr.responseText, xhr.responseXML)\n      } else {\n        options.fail && options.fail(status)\n      }\n    }\n  }\n\n  if (options.type == 'GET') {\n    xhr.open('GET', options.url, true)\n    xhr.send(null)\n  } else if (options.type == 'POST') {\n    xhr.open('POST', options.url, true)\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')\n    xhr.send(options.data)\n  }\n}\n\n/**\n * 进行免登\n */\nfunction _ssoLogin(corpId) {\n  dd.ready(function() {\n    dd.runtime.permission.requestAuthCode({\n      corpId: corpId,\n      onSuccess: function(d) {\n        if (!d || !d.code) {\n          var str = '免登过程中获取钉钉code失败'\n          myObj.debug && logger.error(str)\n          myObj.fail(str)\n          return\n        }\n\n        _ajax({\n          url: myObj.ssoUrl + '?authCode=' + d.code,\n          type: 'GET',\n          data: null,\n          dataType: 'json',\n          success: function(res) {\n            if (!res) {\n              var str = '免登接口集合返回失败'\n              myObj.debug && logger.error(str)\n              myObj.fail(str)\n              return\n            }\n            myObj.success('Login Success!')\n          },\n          fail: function(error) {\n            myObj.debug && logger.error(error)\n            myObj.fail(error)\n          }\n        })\n      },\n      onFail: function(error) {\n        myObj.debug && logger.error(error)\n        myObj.fail(error)\n      }\n    })\n  })\n}\n\n/**\n * 获取免登信息 & 签名\n */\nfunction _getSign() {\n  _ajax({\n    url: myObj.signUrl + '?url=' + location.href,\n    type: 'GET',\n    data: '',\n    dataType: 'json',\n    success: function(res) {\n      res = JSON.parse(res)\n      myObj.debug && logger.log('后台签名数据返回:', res)\n\n      if (!res || typeof res == 'undefined') {\n        var str = 'sign ajax is no result'\n        myObj.debug && logger.error(str)\n        myObj.fail(str)\n        return\n      }\n\n      const _config = res.content\n\n      if (!_config) {\n        var str = 'sign: res.content is no data'\n        myObj.debug && logger.error(str)\n        myObj.fail(str)\n        return\n      }\n\n      dd.config({\n        agentId: _config.agentId,\n        corpId: _config.corpId,\n        timeStamp: _config.timeStamp,\n        nonceStr: _config.nonceStr,\n        signature: _config.signature,\n        jsApiList: myObj.jsApiList\n      })\n\n      dd.error(function(error) {\n        myObj.debug && logger.error(error)\n        myObj.fail(error)\n      })\n\n      // 如果已经登录，则返回true，此时可以不用调用sso\n      if (_config.hasLogin) {\n        myObj.success('Login Success!')\n        return\n      }\n\n      _ssoLogin(_config.corpId)\n    },\n    fail: function(err) {\n      var str = 'sign ajax fail:' + JSON.stringify(err)\n      myObj.debug && logger.error(str)\n      myObj.fail(err)\n    }\n  })\n}\n\n/**\n * 钉钉环境检查\n * false: 在钉钉环境\n * 有值 | true : 非钉钉环境\n */\nfunction _isNotDd() {\n  if (typeof dd === 'undefined') return '请先引入钉钉的JSAPI再调用本库蛤'\n  if (!dd.version) return '非钉钉环境本库不会运行哦'\n  return false\n}\n\n/**\n * 初始化函数\n */\nexport function login(options) {\n  var ndd = _isNotDd()\n  if (ndd) {\n    logger.error(ndd)\n    myObj.fail(ndd)\n    return\n  }\n\n  if (typeof options !== 'object') {\n    var str = '啥参数都不传嘛?'\n    logger.error(str)\n    myObj.fail(str)\n    return\n  }\n\n  if (typeof options.debug !== 'undefined') {\n    myObj.debug = options.debug\n    if (options.debug) logger.warn('开启debug模式')\n  }\n\n  if (options.signUrl) {\n    myObj.signUrl = options.signUrl\n  }\n\n  if (options.ssoUrl) {\n    myObj.ssoUrl = options.ssoUrl\n  }\n\n  if (options.jsApiList) {\n    myObj.jsApiList = options.jsApiList\n  }\n\n  if (options.success) {\n    myObj.success = options.success\n  }\n\n  if (options.fail) {\n    myObj.fail = options.fail\n  }\n\n  myObj.debug && logger.log('当前入参:', myObj)\n\n  _getSign()\n}\n\nexport default { login }\n\n// export function otherAIP() {\n//   return xxx\n// }\n"],"sourceRoot":""}