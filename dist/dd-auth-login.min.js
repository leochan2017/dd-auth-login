!function(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.ddAuthLogin=i():e.ddAuthLogin=i()}(window,function(){return function(e){var i={};function n(t){if(i[t])return i[t].exports;var o=i[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=i,n.d=function(e,i,t){n.o(e,i)||Object.defineProperty(e,i,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,i){if(1&i&&(e=n(e)),8&i)return e;if(4&i&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&i&&"string"!=typeof e)for(var o in e)n.d(t,o,function(i){return e[i]}.bind(null,o));return t},n.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(i,"a",i),i},n.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},n.p="",n(n.s="./src/index.js")}({"./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! exports provided: isDD, login, default */function(e,i,n){"use strict";n.r(i),n.d(i,"isDD",function(){return u}),n.d(i,"login",function(){return c});var t=function(){},o={libName:"ddAuthLogin",debug:!1,signUrl:"/data/labc-biz-dingding/dingTalk/getAuthInfo",signParamName:"url",ssoUrl:"/data/labc-biz-dingding/dingTalk/sso",ssoParamName:"authCode",success:t,fail:t,jsApiList:["runtime.permission.requestAuthCode","biz.util.datepicker","biz.util.timepicker","biz.util.datetimepicker","biz.ding.post","biz.telephone.call","biz.user.get","biz.contact.choose","biz.contact.createGroup","biz.contact.complexChoose","biz.util.chosen","biz.util.openLink","biz.util.uploadImage","biz.util.previewImage","biz.util.open","biz.util.share","biz.navigation.setTitle","biz.navigation.setLeft","biz.navigation.setRight","biz.navigation.close","biz.chat.pickConversation","biz.chat.chooseConversation","biz.chat.toConversation","biz.chat.chooseConversationByCorpId","biz.navigation.setIcon","ui.progressBar.setColors","ui.webViewBounce.disable","ui.input.plain","device.audio.startRecord","device.audio.stopRecord","device.audio.translateVoice","biz.telephone.showCallMenu","device.geolocation.get","biz.navigation.hideBar"]},s="undefined"==typeof console?{log:t,debug:t,error:t,warn:t,info:t}:console;function r(e){if((e=e||{}).type=(e.type||"GET").toUpperCase(),e.dataType=e.dataType||"json",window.XMLHttpRequest)var i=new XMLHttpRequest;else i=new ActiveXObject("Microsoft.XMLHTTP");i.onreadystatechange=function(){if(4==i.readyState){var n=i.status;n>=200&&n<300?e.success&&e.success(i.responseText,i.responseXML):e.fail&&e.fail(n)}},"GET"==e.type?(i.open("GET",e.url,!0),i.send(null)):"POST"==e.type&&(i.open("POST",e.url,!0),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(e.data))}function a(){r({url:o.signUrl+"?"+o.signParamName+"="+location.href,type:"GET",data:"",dataType:"json",success:function(e){if(e=JSON.parse(e),o.debug&&s.log("后台签名数据返回:",e),!e||void 0===e){var i="sign ajax is no result";return o.debug&&s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}const n=e.content;if(!n){i="sign: res.content is no data";return o.debug&&s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}var t;(dd.config({agentId:n.agentId,corpId:n.corpId,timeStamp:n.timeStamp,nonceStr:n.nonceStr,signature:n.signature,jsApiList:o.jsApiList}),dd.error(function(e){o.debug&&s.error(e),o.fail({isDD:!0,isLogin:!1,msg:"dd.error",content:e})}),n.hasLogin)?o.success({isDD:!0,isLogin:!0,msg:"Login Success!"}):(t=n.corpId,dd.ready(function(){dd.runtime.permission.requestAuthCode({corpId:t,onSuccess:function(e){if(!e||!e.code){var i="免登过程中获取钉钉code失败";return o.debug&&s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}r({url:o.ssoUrl+"?"+o.ssoParamName+"="+e.code,type:"GET",data:null,dataType:"json",success:function(e){if(!e){var i="免登接口集合返回失败";return o.debug&&s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}o.success({isDD:!0,isLogin:!0,msg:"Login Success!"})},fail:function(e){o.debug&&s.error(e),o.fail({isDD:!0,isLogin:!1,msg:"Login Fail!",content:e})}})},onFail:function(e){o.debug&&s.error(e),o.fail({isDD:!0,isLogin:!1,msg:"Login Fail!",content:e})}})}))},fail:function(e){var i="sign ajax fail:"+JSON.stringify(e);o.debug&&s.error(i),o.fail({isDD:!0,isLogin:!1,msg:"sign ajax fail",content:e})}})}function u(){return/DingTalk/i.test("undefined"!=typeof navigator&&(navigator&&(navigator.userAgent||navigator.swuserAgent)||""))}function c(e){if("object"!=typeof e){var i="啥参数都不传嘛?";return s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}if(void 0!==e.debug&&(o.debug=e.debug,e.debug&&s.warn("开启debug模式")),e.signUrl&&(o.signUrl=e.signUrl),e.signParamName&&(o.signParamName=e.signParamName),e.ssoUrl&&(o.ssoUrl=e.ssoUrl),e.ssoParamName&&(o.ssoParamName=e.ssoParamName),e.jsApiList&&(o.jsApiList=e.jsApiList),e.success&&(o.success=e.success),e.fail&&(o.fail=e.fail),o.debug&&s.log("当前入参:",o),!u()){i="非钉钉环境本库不会继续签名和免登哦";return o.debug&&s.warn(i),void o.success({isDD:!1,isLogin:!1,msg:i})}if("object"!=typeof dd){i="请先完全引入钉钉 js 库再调用本库";return o.debug&&s.error(i),void o.fail({isDD:!0,isLogin:!1,msg:i})}a()}s.debug||(s.debug=t),i.default={login:c,isDD:u}}})});
//# sourceMappingURL=dd-auth-login.min.js.map